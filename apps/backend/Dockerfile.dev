# Dockerfile.dev (apps/backend/Dockerfile.dev)
# Development Dockerfile with hot reload

FROM node:22-alpine

# Install build dependencies for sqlite3 and native modules
RUN apk add --no-cache python3 make g++ sqlite

# Install pnpm globally
RUN npm install -g pnpm

# Set working directory
WORKDIR /app

# Copy monorepo package files
COPY package.json pnpm-workspace.yaml ./
COPY pnpm-lock.yaml* ./

# Copy backend package.json
COPY apps/backend/package.json ./apps/backend/

# Copy backend source code
COPY apps/backend ./apps/backend

# Install dependencies
RUN pnpm install
RUN pnpm install sqlite3 -w

# Create data directory
RUN mkdir -p /app/apps/backend/data

# Set working directory to backend
WORKDIR /app/apps/backend

# Expose port
EXPOSE 3001

# Default command for development (with hot reload)
CMD ["pnpm", "dev"]